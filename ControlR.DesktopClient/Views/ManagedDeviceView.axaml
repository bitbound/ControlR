<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             xmlns:vm="using:ControlR.DesktopClient.ViewModels"
             xmlns:fakes="using:ControlR.DesktopClient.ViewModels.Fakes"
             xmlns:common="using:ControlR.DesktopClient.Common"
             xmlns:avalonia="using:Avalonia"
             x:Class="ControlR.DesktopClient.Views.ManagedDeviceView"
             x:DataType="vm:IManagedDeviceViewModel">

  <Design.DataContext>
    <fakes:ManagedDeviceViewModelFake />
  </Design.DataContext>

  <Border Margin="10" HorizontalAlignment="Center">
    <Grid RowDefinitions="Auto,*,Auto">
      <!-- Header row with theme toggle button -->
      <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,20">
        <TextBlock Grid.Column="0"
                   Classes="h1 Primary"
                   Text="{x:Static common:Localization.ManagedDeviceTitle}"
                   VerticalAlignment="Center" />

        <Button Grid.Column="1"
                Command="{Binding ToggleThemeCommand}"
                Background="Transparent"
                BorderThickness="1"
                BorderBrush="{DynamicResource DividerBrush}"
                CornerRadius="4"
                Padding="12,6"
                ToolTip.Tip="{Binding ThemeModeText}">
            <Panel Width="16" Height="16">
                <!-- Auto mode icon -->
                <PathIcon Data="{StaticResource arrow_sync_circle_regular}"
                          IsVisible="{Binding ThemeIconKey, Converter={StaticResource StringEqualsConverter}, ConverterParameter=arrow_sync_circle_regular}"
                          Foreground="{DynamicResource TextPrimaryBrush}" />
                <!-- Light mode icon -->
                <PathIcon Data="{StaticResource weather_sunny_regular}"
                          IsVisible="{Binding ThemeIconKey, Converter={StaticResource StringEqualsConverter}, ConverterParameter=weather_sunny_regular}"
                          Foreground="{DynamicResource TextPrimaryBrush}" />
                <!-- Dark mode icon -->
                <PathIcon Data="{StaticResource weather_moon_regular}"
                          IsVisible="{Binding ThemeIconKey, Converter={StaticResource StringEqualsConverter}, ConverterParameter=weather_moon_regular}"
                          Foreground="{DynamicResource TextPrimaryBrush}" />
            </Panel>
        </Button>
      </Grid>

      <!-- Main content -->
      <StackPanel Grid.Row="1">
        <TextBlock Text="{x:Static common:Localization.ManagedDeviceMessage}"
                   TextWrapping="Wrap" />

        <StackPanel IsVisible="{Binding IsMacOs}" Margin="0,28,0,0">
          <TextBlock Classes="h2 Info" Text="{x:Static common:Localization.MacOsPermissions}" />

          <!-- Accessibility -->
          <Border Classes="Card" Margin="0,20,0,0">
            <StackPanel>
            <TextBlock Text="{x:Static common:Localization.Accessibility}" FontWeight="Bold" FontSize="16" Margin="0,0,0,8" />
              <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="20" Margin="0,0,0,8">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
                  <TextBlock Text="{x:Static common:Localization.Status}" VerticalAlignment="Center" />
                  <Border CornerRadius="6" Padding="8,2" Background="{DynamicResource SuccessColor}" IsVisible="{Binding IsAccessibilityPermissionGranted}">
                    <TextBlock Text="{x:Static common:Localization.Granted}" Foreground="{DynamicResource SuccessContrastText}" FontWeight="Bold" />
                  </Border>
                  <Border CornerRadius="6" Padding="8,2" Background="{DynamicResource ErrorColor}" IsVisible="{Binding IsAccessibilityPermissionGranted, Converter={StaticResource InverseBooleanConverter}}">
                    <TextBlock Text="{x:Static common:Localization.NotGranted}" Foreground="{DynamicResource ErrorContrastText}" FontWeight="Bold" />
                  </Border>
                </StackPanel>
                <Button Content="{x:Static common:Localization.OpenSettings}"
                        Command="{Binding OpenAccessibilitySettingsCommand}"
                        Margin="16,0,0,0" />
              </StackPanel>
              <TextBlock Text="{x:Static common:Localization.AccessibilityPermissionDescription}"
                         Classes="Small"
                         TextWrapping="Wrap" />
            </StackPanel>
          </Border>

          <!-- Screen Capture -->
          <Border Classes="Card" Margin="0,20,0,0">
            <StackPanel>
              <TextBlock Text="{x:Static common:Localization.ScreenRecording}" FontWeight="Bold" FontSize="16" Margin="0,0,0,8" />
              <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="20" Margin="0,0,0,8">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
                  <TextBlock Text="{x:Static common:Localization.Status}" VerticalAlignment="Center" />
                  <Border CornerRadius="6" Padding="8,2" Background="{DynamicResource SuccessColor}" IsVisible="{Binding IsScreenCapturePermissionGranted}">
                    <TextBlock Text="{x:Static common:Localization.Granted}" Foreground="{DynamicResource SuccessContrastText}" FontWeight="Bold" />
                  </Border>
                  <Border CornerRadius="6" Padding="8,2" Background="{DynamicResource ErrorColor}" IsVisible="{Binding IsScreenCapturePermissionGranted, Converter={StaticResource InverseBooleanConverter}}">
                    <TextBlock Text="{x:Static common:Localization.NotGranted}" Foreground="{DynamicResource ErrorContrastText}" FontWeight="Bold" />
                  </Border>
                </StackPanel>
                <Button Content="{x:Static common:Localization.OpenSettings}"
                        Command="{Binding OpenScreenCaptureSettingsCommand}"
                        Margin="16,0,0,0" />
              </StackPanel>
              <TextBlock Text="{x:Static common:Localization.ScreenCapturePermissionDescription}"
                         Classes="Small"
                         TextWrapping="Wrap" />
            </StackPanel>
          </Border>
        </StackPanel>

      </StackPanel>

      <!-- Version information positioned at bottom right -->
      <TextBlock Grid.Row="2"
                 HorizontalAlignment="Right"
                 VerticalAlignment="Bottom"
                 Margin="0,20,0,10"
                 Classes="Small"
                 Opacity="0.8">
        <Run Text="{x:Static common:Localization.Version}" />
        <Run Text=": " />
        <Run Text="{Binding AppVersion}" />
      </TextBlock>
    </Grid>
  </Border>
</UserControl>
