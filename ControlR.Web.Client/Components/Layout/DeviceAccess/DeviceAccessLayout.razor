@using ControlR.Libraries.Shared.Enums
@inherits LayoutComponentBase
@attribute [Authorize]


<div class="h-100 @(ThemeClass)">
  <link rel="stylesheet" href="/device-access.css" />
  <CascadingValue Value="CurrentPalette">
    <MudThemeProvider @bind-IsDarkMode="@_isDarkMode" Theme="CustomTheme" />
    <MudPopoverProvider />
    <MudDialogProvider />
    <MudSnackbarProvider />
    <MudLayout>
      <MudAppBar Elevation="1">

        @if (RendererInfo.IsInteractive)
        {
          <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start"
            OnClick="@(() => ToggleNavDrawer())" />
        }
        else
        {
          <MudStaticNavDrawerToggle DrawerId="nav-drawer" Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit"
            Edge="Edge.Start" />
        }

        @if (!string.IsNullOrWhiteSpace(_deviceName))
        {
          <MudText Typo="Typo.subtitle2" Color="Color.Info" Class="ms-4" Inline>
            Device:
          </MudText>
          <MudText Typo="Typo.subtitle2" Class="ms-1" Inline>
            @_deviceName
          </MudText>
        }

        <MudSpacer />

        <ConnectionIndicator THub="@IViewerHub" />

        <ThemeToggle OnThemeChanged="HandleThemeChanged" />

        <MudTooltip Text="GitHub">
          <MudIconButton Icon="@Icons.Custom.Brands.GitHub" Color="Color.Inherit"
            Href="https://github.com/bitbound/controlr/" Target="_blank" />

        </MudTooltip>
      </MudAppBar>
      <MudDrawer @bind-Open="_drawerOpen" id="nav-drawer" ClipMode="DrawerClipMode.Always" Elevation="2">
        <MudDrawerHeader Class="pa-4">
          <MudImage Src=@Assets["icon-192.png"] Height="30" Class="me-2" />
          <MudText Typo="Typo.h6" Color="Color.Primary">
            ControlR
          </MudText>
        </MudDrawerHeader>
        <DeviceAccessNavMenu IsDisabled="@(IsNavMenuDisabled)" />
      </MudDrawer>
      <MudMainContent Class="h-100">
        <ServerAlertDisplay Class="mb-4" />
        @if (!RendererInfo.IsInteractive || !string.IsNullOrWhiteSpace(_loadingText))
        {
          <LoadingIndicator IsVisible Message="@(_loadingText ?? "Loading")" Class="mt-8" />
        }
        else if (!string.IsNullOrWhiteSpace(_errorText))
        {
          <MudAlert Severity="Severity.Error" ShowCloseIcon="false" Icon="@(Icons.Material.Filled.Error)">
            @(_errorText)
          </MudAlert>
        }
        else
        {
          if (!string.IsNullOrWhiteSpace(_deviceName))
          {
            <PageTitle>
              ControlR - @(_deviceName)
            </PageTitle>
          }
          @Body
        }
      </MudMainContent>
    </MudLayout>
  </CascadingValue>
</div>