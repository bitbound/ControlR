@attribute [Route(ClientRoutes.ApiKeys)]
@attribute [Authorize(Roles = RoleNames.TenantAdministrator)]

<PageTitle>API Keys</PageTitle>

<PrimaryTitle>
  API Keys
</PrimaryTitle>

<MudCard Class="mb-4">
  <MudCardContent>
    <MudGrid>
      <MudItem xs="12" sm="8">
        <MudTextField @bind-Value="_newKeyName"
                      Label="Friendly Name"
                      Placeholder="Enter a friendly name for the API key"
                      Immediate="true"
                      OnKeyDown="OnKeyDown"
                      Disabled="_isLoading" />
      </MudItem>
      <MudItem xs="12" sm="4">
        <MudButton Color="Color.Primary"
                   Variant="Variant.Filled"
                   OnClick="CreateApiKey"
                   Disabled="@(string.IsNullOrWhiteSpace(_newKeyName) || _isLoading)"
                   FullWidth="true">
          @if (_isLoading)
          {
            <MudProgressCircular Size="Size.Small" Indeterminate="true" />
          }
          else
          {
            <text>Create API Key</text>
          }
        </MudButton>
      </MudItem>
    </MudGrid>
  </MudCardContent>
</MudCard>

<MudDataGrid T="ApiKeyDto"
             Items="@_apiKeys"
             Loading="_isLoading"
             Dense="true"
             Hover="true"
             Striped="true"
             SortMode="SortMode.Single">
  <Columns>
    <PropertyColumn Property="x => x.FriendlyName" Title="Name" />
    <PropertyColumn Property="x => x.CreatedOn" Title="Created" Format="yyyy-MM-dd HH:mm" />
    <PropertyColumn Property="x => x.LastUsed" Title="Last Used" Format="yyyy-MM-dd HH:mm">
      <CellTemplate>
        @if (context.Item.LastUsed.HasValue)
        {
          @context.Item.LastUsed.Value.ToString("yyyy-MM-dd HH:mm")
        }
        else
        {
          <text>Never</text>
        }
      </CellTemplate>
    </PropertyColumn>
    <TemplateColumn Title="Actions" Sortable="false">
      <CellTemplate>
        <MudButton Color="Color.Error"
                   Size="Size.Small"
                   Variant="Variant.Text"
                   OnClick="() => DeleteApiKey(context.Item)">
          Delete
        </MudButton>
      </CellTemplate>
    </TemplateColumn>
  </Columns>
</MudDataGrid>

