@attribute [Route(ClientRoutes.ApiKeys)]
@attribute [Authorize(Roles = RoleNames.TenantAdministrator)]

<PageTitle>API Keys</PageTitle>

<PrimaryTitle>
  API Keys
</PrimaryTitle>

<MudCard Class="mb-4">
  <MudCardContent>
    <MudGrid>
      <MudItem xs="12" sm="8" Class="d-flex align-end">
        <MudTextField @bind-Value="_newKeyName" Label="Key Name" Placeholder="Enter a friendly name for the API key"
                      Immediate="true" OnKeyDown="OnKeyDown" Disabled="_isLoading" />
      </MudItem>
      <MudItem xs="12" sm="4" Class="d-flex align-end">
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="CreateApiKey"
                   Disabled="@(string.IsNullOrWhiteSpace(_newKeyName) || _isLoading)" FullWidth="true">
          Create API Key
        </MudButton>
      </MudItem>
    </MudGrid>
  </MudCardContent>
</MudCard>

<MudDataGrid T="ApiKeyDto" 
             Items="@_apiKeys" 
             Loading="_isLoading" 
             ShowColumnOptions="true" 
             Filterable="true" 
             SortMode="SortMode.Single">
  <Columns>
    <PropertyColumn Property="x => x.FriendlyName" Title="Name" />
    <PropertyColumn Property="x => x.CreatedOn" Title="Created" />
    <PropertyColumn Property="x => x.LastUsed" Title="Last Used">
      <CellTemplate>
        @if (context.Item.LastUsed.HasValue)
        {
          @context.Item.LastUsed.Value
        }
        else
        {
          <text>Never</text>
        }
      </CellTemplate>
    </PropertyColumn>
    <TemplateColumn Title="Actions" Sortable="false">
      <CellTemplate>
        <MudTooltip Text="Rename">
          <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Info" Size="Size.Small"
                         OnClick="() => RenameApiKey(context.Item)" />
        </MudTooltip>

        <MudTooltip Text="Delete">
          <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small"
                         OnClick="() => DeleteApiKey(context.Item)" />
        </MudTooltip>
      </CellTemplate>
    </TemplateColumn>
  </Columns>
</MudDataGrid>
