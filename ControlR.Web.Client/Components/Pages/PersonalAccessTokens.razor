@attribute [Route(ClientRoutes.PersonalAccessTokens)]

<PageTitle>Personal Access Tokens</PageTitle>

<PrimaryTitle>
  Personal Access Tokens
</PrimaryTitle>

<MudAlert Severity="Severity.Info" Class="mb-4">
  Personal access tokens should be added to the 'x-api-key' header to authenticate requests.
</MudAlert>

<MudCard Class="mb-4">
  <MudCardContent>
    <MudGrid>
      <MudItem xs="12" sm="8" Class="d-flex align-end">
        <MudTextField @bind-Value="_newTokenName" Label="Token Name" Placeholder="Enter a friendly name for the personal access token"
          Immediate="true" OnKeyDown="OnKeyDown" Disabled="_isLoading" />
      </MudItem>
      <MudItem xs="12" sm="4" Class="d-flex align-end">
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="CreatePersonalAccessToken"
          Disabled="@(string.IsNullOrWhiteSpace(_newTokenName) || _isLoading)">
          Create Personal Access Token
        </MudButton>
      </MudItem>
    </MudGrid>
  </MudCardContent>
</MudCard>

<MudDataGrid T="ApiKeyDto" Items="@_personalAccessTokens" Loading="_isLoading" ShowColumnOptions="true" Filterable="true"
  SortMode="SortMode.Single">
  <Columns>
    <PropertyColumn Property="x => x.FriendlyName" Title="Name" />
    <PropertyColumn Property="x => x.CreatedAt" Title="Created" />
    <PropertyColumn Property="x => x.LastUsed" Title="Last Used">
      <CellTemplate>
        @if (context.Item.LastUsed.HasValue)
        {
          @context.Item.LastUsed.Value
        }
        else
        {
          <text>Never</text>
        }
      </CellTemplate>
    </PropertyColumn>
    <TemplateColumn Title="Actions" Sortable="false">
      <CellTemplate>
        <MudTooltip Text="Rename">
          <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Info" Size="Size.Small"
            OnClick="() => RenamePersonalAccessToken(context.Item)" />
        </MudTooltip>

        <MudTooltip Text="Delete">
          <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small"
            OnClick="() => DeletePersonalAccessToken(context.Item)" />
        </MudTooltip>
      </CellTemplate>
    </TemplateColumn>
  </Columns>
</MudDataGrid>
