@using Microsoft.AspNetCore.Antiforgery
@inject IServiceProvider Services

<MudStaticButton FormAction="FormAction.Submit"
                 name="__passkeySubmit"
                 Variant="@Variant"
                 Color="@Color"
                 @attributes="AdditionalAttributes">
  @ChildContent
</MudStaticButton>
<passkey-submit
  operation="@Operation"
  name="@Name"
  email-name="@EmailName"
  request-token-name="@_tokens?.HeaderName"
  request-token-value="@_tokens?.RequestToken">
</passkey-submit>

@code {
  private AntiforgeryTokenSet? _tokens;

  [CascadingParameter]
  private HttpContext HttpContext { get; set; } = default!;

  [Parameter]
  [EditorRequired]
  public PasskeyOperation Operation { get; set; }

  [Parameter]
  [EditorRequired]
  public string Name { get; set; } = default!;

  [Parameter]
  public string? EmailName { get; set; }

  [Parameter]
  public RenderFragment? ChildContent { get; set; }

  [Parameter]
  public Variant Variant { get; set; } = Variant.Filled;

  [Parameter]
  public Color Color { get; set; } = Color.Secondary;

  [Parameter(CaptureUnmatchedValues = true)]
  public IDictionary<string, object>? AdditionalAttributes { get; set; }

  protected override void OnInitialized()
  {
    _tokens = Services.GetService<IAntiforgery>()?.GetTokens(HttpContext);
  }
}
